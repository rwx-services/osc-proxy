<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>OSC Proxy</title>
  <link rel="stylesheet" href="../dist/styles.css">
</head>
<body class="overflow-hidden">
  <div class="h-screen flex flex-col">
    <!-- Dashboard Header -->
    <header id="dashboard-header" class="glass border-b border-proxy-gray-light/30 px-6 py-4 flex-shrink-0">
      <div class="flex items-center justify-between">
        <div id="connection-status" class="flex items-center gap-2">
          <div class="status-indicator status-idle" id="status-indicator"></div>
          <span class="text-sm text-gray-400" id="status-text">Idle</span>
        </div>
        <div class="flex items-center gap-3">
          <button id="start-button" class="px-4 py-2 bg-green-600 hover:bg-green-700 text-white text-sm font-medium rounded-lg transition-colors">
            Start All
          </button>
          <button id="stop-button" class="px-4 py-2 bg-red-600 hover:bg-red-700 text-white text-sm font-medium rounded-lg transition-colors hidden">
            Stop All
          </button>
        </div>
      </div>
    </header>

    <!-- Settings Header -->
    <header id="settings-header" class="glass border-b border-proxy-gray-light/30 px-6 py-4 flex-shrink-0 hidden">
      <div class="flex items-center justify-between">
        <h1 class="text-xl font-bold">Settings</h1>
        <button id="btn-close-settings" class="text-gray-400 hover:text-white transition-colors">
          <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path>
          </svg>
        </button>
      </div>
    </header>

    <!-- Dashboard View -->
    <div id="view-dashboard" class="flex-1 overflow-hidden flex flex-col">
      <main class="flex-1 overflow-y-auto p-6">
        <!-- Listeners Section -->
        <div class="mb-6">
          <h2 class="text-lg font-semibold mb-4">Listeners</h2>
          <div id="listeners-container" class="grid grid-cols-2 gap-4 mb-6">
            <!-- Listener cards will be inserted here -->
            <div class="col-span-2 metric-card text-center py-12" id="no-listeners">
              <div class="text-gray-500 mb-4">
                <svg class="w-16 h-16 mx-auto mb-3 text-gray-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 6v6m0 0v6m0-6h6m-6 0H6"></path>
                </svg>
                <p class="text-lg font-medium mb-1">No Listeners Configured</p>
                <p class="text-sm">Get started by adding your first OSC listener</p>
              </div>
              <button id="btn-open-settings" class="btn-primary mx-auto">
                Open Settings to Add Listener
              </button>
            </div>
          </div>
        </div>

        <!-- Aggregate Metrics -->
        <h2 class="text-lg font-semibold mb-4">Aggregate Metrics</h2>

        <!-- Primary Metrics -->
        <div class="grid grid-cols-3 gap-6 mb-6">
          <div class="metric-card-large">
            <div class="metric-label">Current Rate</div>
            <div class="metric-value text-green-400 glow-accent" id="metric-rate">0.0</div>
            <div class="metric-unit">msg/s</div>
            <div class="mt-4 h-16 flex items-end gap-1" id="rate-sparkline"></div>
          </div>

          <div class="metric-card-large">
            <div class="metric-label">Average Rate</div>
            <div class="metric-value text-blue-400" id="metric-avg-rate">0.0</div>
            <div class="metric-unit">msg/s</div>
            <div class="mt-4 text-xs text-gray-500">Over entire session</div>
          </div>

          <div class="metric-card-large">
            <div class="metric-label">Peak Rate</div>
            <div class="metric-value text-purple-400" id="metric-peak-rate">0.0</div>
            <div class="metric-unit">msg/s</div>
            <div class="mt-4 text-xs text-gray-500">Maximum observed</div>
          </div>
        </div>

        <!-- Secondary Metrics -->
        <div class="grid grid-cols-4 gap-4 mb-6">
          <div class="metric-card">
            <div class="metric-label">Latency</div>
            <div class="text-2xl font-bold tabular-nums" id="metric-latency">0.00</div>
            <div class="metric-unit">milliseconds</div>
          </div>

          <div class="metric-card">
            <div class="metric-label">Total Received</div>
            <div class="text-2xl font-bold tabular-nums" id="metric-total">0</div>
            <div class="metric-unit">messages</div>
          </div>

          <div class="metric-card">
            <div class="metric-label">Forwarded</div>
            <div class="text-2xl font-bold tabular-nums text-green-400" id="metric-forwarded">0</div>
            <div class="metric-unit">messages</div>
          </div>

          <div class="metric-card">
            <div class="metric-label">Dropped</div>
            <div class="text-2xl font-bold tabular-nums text-red-400" id="metric-dropped">0</div>
            <div class="metric-unit"><span id="metric-loss">0.0</span>% loss</div>
          </div>
        </div>
      </main>
    </div>

    <!-- Settings View -->
    <div id="view-settings" class="flex-1 overflow-hidden hidden">
      <main class="flex-1 overflow-hidden flex h-full">
        <!-- Left Panel: Listeners List -->
        <div class="w-80 border-r border-proxy-gray-light/30 flex flex-col">
          <div class="p-4 border-b border-proxy-gray-light/30">
            <div class="flex items-center justify-between mb-3">
              <h2 class="text-lg font-semibold">Listeners</h2>
              <button id="btn-add-listener" class="btn-primary text-sm px-3 py-1">+ Add</button>
            </div>
            <p class="text-xs text-gray-400">Manage OSC input sources</p>
          </div>

          <div id="listeners-list" class="flex-1 overflow-y-auto p-2">
            <!-- Listener items will be populated here -->
          </div>
        </div>

        <!-- Right Panel: Listener Details -->
        <div class="flex-1 overflow-y-auto p-6">
          <div id="no-selection" class="flex items-center justify-center h-full text-gray-500">
            Select a listener to view details
          </div>

          <div id="listener-details" class="hidden space-y-6 max-w-3xl">
            <!-- Listener Info -->
            <div class="metric-card">
              <div class="flex items-center justify-between mb-4">
                <h2 class="text-lg font-semibold">Listener Configuration</h2>
                <div class="flex gap-2">
                  <button id="btn-save-listener" class="btn-primary text-sm">Save</button>
                  <button id="btn-delete-listener" class="btn-secondary text-sm text-red-400 hover:text-red-300">Delete</button>
                </div>
              </div>

              <div class="space-y-4">
                <div>
                  <label class="block text-sm text-gray-400 mb-2">Name</label>
                  <input type="text" id="listener-name" class="w-full bg-proxy-gray border border-proxy-gray-light rounded px-3 py-2 focus:outline-none focus:ring-2 focus:ring-proxy-accent" placeholder="e.g., Lightkey Input">
                </div>

                <div>
                  <label class="block text-sm text-gray-400 mb-2">Protocol</label>
                  <select id="listener-protocol" class="w-full bg-proxy-gray border border-proxy-gray-light rounded px-3 py-2 focus:outline-none focus:ring-2 focus:ring-proxy-accent">
                    <option value="udp">UDP</option>
                    <option value="tcp">TCP</option>
                  </select>
                </div>

                <div id="listener-udp-fields">
                  <div class="grid grid-cols-2 gap-4">
                    <div>
                      <label class="block text-sm text-gray-400 mb-2">Listen Port</label>
                      <input type="number" id="listener-port" class="w-full bg-proxy-gray border border-proxy-gray-light rounded px-3 py-2 focus:outline-none focus:ring-2 focus:ring-proxy-accent" placeholder="21650">
                    </div>
                    <div>
                      <label class="block text-sm text-gray-400 mb-2">Bind Address</label>
                      <input type="text" id="listener-bind" class="w-full bg-proxy-gray border border-proxy-gray-light rounded px-3 py-2 focus:outline-none focus:ring-2 focus:ring-proxy-accent" placeholder="127.0.0.1">
                    </div>
                  </div>
                </div>

                <div id="listener-tcp-fields" class="hidden">
                  <div class="grid grid-cols-2 gap-4">
                    <div>
                      <label class="block text-sm text-gray-400 mb-2">Listen Port</label>
                      <input type="number" id="listener-tcp-port" class="w-full bg-proxy-gray border border-proxy-gray-light rounded px-3 py-2 focus:outline-none focus:ring-2 focus:ring-proxy-accent" placeholder="21650">
                    </div>
                    <div>
                      <label class="block text-sm text-gray-400 mb-2">Bind Address</label>
                      <input type="text" id="listener-tcp-bind" class="w-full bg-proxy-gray border border-proxy-gray-light rounded px-3 py-2 focus:outline-none focus:ring-2 focus:ring-proxy-accent" placeholder="127.0.0.1">
                    </div>
                  </div>
                </div>

                <div class="flex items-center">
                  <input type="checkbox" id="listener-enabled" class="mr-2">
                  <label for="listener-enabled" class="text-sm text-gray-400">Enabled</label>
                </div>
              </div>
            </div>

            <!-- Forwarders -->
            <div class="metric-card">
              <div class="flex items-center justify-between mb-4">
                <div>
                  <h2 class="text-lg font-semibold">Forwarders</h2>
                  <p class="text-xs text-gray-400 mt-1">Messages will be broadcast to all forwarders</p>
                </div>
                <button id="btn-add-forwarder" class="btn-primary text-sm px-3 py-1">+ Add Forwarder</button>
              </div>

              <div id="forwarders-list" class="space-y-3"></div>

              <div id="no-forwarders" class="text-center py-8 text-gray-500 text-sm">
                No forwarders configured. Add one to start forwarding messages.
              </div>
            </div>
          </div>
        </div>
      </main>
    </div>

    <!-- Add/Edit Forwarder Modal -->
    <div id="forwarder-modal" class="hidden fixed inset-0 bg-black/50 flex items-center justify-center z-50">
      <div class="bg-proxy-dark border border-proxy-gray-light rounded-lg p-6 w-full max-w-md">
        <h3 class="text-lg font-semibold mb-4" id="forwarder-modal-title">Add Forwarder</h3>

        <div class="space-y-4">
          <div>
            <label class="block text-sm text-gray-400 mb-2">Name</label>
            <input type="text" id="fwd-name" class="w-full bg-proxy-gray border border-proxy-gray-light rounded px-3 py-2 focus:outline-none focus:ring-2 focus:ring-proxy-accent" placeholder="e.g., Lightkey Destination">
          </div>

          <div>
            <label class="block text-sm text-gray-400 mb-2">Protocol</label>
            <select id="fwd-protocol" class="w-full bg-proxy-gray border border-proxy-gray-light rounded px-3 py-2 focus:outline-none focus:ring-2 focus:ring-proxy-accent">
              <option value="tcp">TCP</option>
              <option value="udp">UDP</option>
            </select>
          </div>

          <div class="grid grid-cols-2 gap-4">
            <div>
              <label class="block text-sm text-gray-400 mb-2">Host</label>
              <input type="text" id="fwd-host" class="w-full bg-proxy-gray border border-proxy-gray-light rounded px-3 py-2 focus:outline-none focus:ring-2 focus:ring-proxy-accent" placeholder="127.0.0.1">
            </div>
            <div>
              <label class="block text-sm text-gray-400 mb-2">Port</label>
              <input type="number" id="fwd-port" class="w-full bg-proxy-gray border border-proxy-gray-light rounded px-3 py-2 focus:outline-none focus:ring-2 focus:ring-proxy-accent" placeholder="21600">
            </div>
          </div>

          <div class="flex items-center">
            <input type="checkbox" id="fwd-enabled" class="mr-2" checked>
            <label for="fwd-enabled" class="text-sm text-gray-400">Enabled</label>
          </div>
        </div>

        <div class="flex justify-end gap-2 mt-6">
          <button id="btn-cancel-forwarder" class="btn-secondary text-sm">Cancel</button>
          <button id="btn-save-forwarder" class="btn-primary text-sm">Save</button>
        </div>
      </div>
    </div>
  </div>

  <script src="./js/renderer.js"></script>
  <script src="./js/settings.js"></script>
</body>
</html>
